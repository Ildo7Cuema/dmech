import{n as oe,r as b,C as se,z as le,_ as H,P as R,E as Z,p as l,q as p,s,t as o,H as i,Q as q,x as u,y as m,G as r,aZ as k,N as _,I as f,v as n,B as te,K as U,L as re,M as ne,bm as ie,aT as de,aS as F,bq as ue,aR as me,J as M,F as ce,ap as fe,aU as pe,aV as be}from"./index.e70dc7e8.js";import{b as ge,a as G}from"./QLayout.ca9f809c.js";import{Q as ye}from"./QSpace.cccfce51.js";import{Q as S}from"./QTd.e931d9bd.js";import{Q as $}from"./QTooltip.8d7a7274.js";import{Q as _e}from"./QTable.324e303e.js";import{a as we,Q as O}from"./position-engine.1f1eaf41.js";import{Q as B}from"./QItemLabel.f0026656.js";import{Q as he}from"./QList.9cd80ca5.js";import{Q as ve}from"./QPageSticky.09a25c3d.js";import{Q as ke}from"./QForm.7b26f9a5.js";import{Q as Ue}from"./QPage.63b09b87.js";import{C as Ce}from"./ClosePopup.39a76e78.js";import"./userApi.7be80cfa.js";import{u as Qe}from"./useNotify.e83fbf31.js";import{u as Ve}from"./use-quasar.4cac9bb9.js";import{b as ze,i as qe}from"./inputVisual.14accdd7.js";import{a as Se}from"./adminAccessOp.24fd89a7.js";import"./selection.ded15137.js";import"./QSelect.9e4cb652.js";import"./QMenu.704bcb1b.js";import"./rtl.b51694b1.js";import"./use-fullscreen.63635d9e.js";const $e=[{name:"name",label:"Usu\xE1rio",align:"left",field:"name",sortable:!0},{name:"email",label:"E-mail",align:"left",field:"email",sortable:!0},{name:"role",label:"N\xEDvel de acesso",align:"left",field:"role",sortable:!0},{name:"status",label:"Status",align:"left",field:"status",sortable:!0},{name:"actions",label:"Op\xE7\xF5es",align:"left",field:"actions",sortable:!0}];const Ae=oe({components:{adminAccessOp:Se},setup(){const a=b([]),{listUsers:t,updateStatusUser:A,updateSingleUser:N,deleteUser:I,user:y,createNewUser:w}=se(),e=b(""),g=Ve(),C=b(!1),{notifyError:Q,notifySuccess:V}=Qe(),J=b(!1),K=b({}),E=b(""),z=b(!0),D=b({loading:!1}),c=b({name:"",email:"",role:"",password:"",phone:"",photoURL:"",emailAdmin:y.value.email,organization_id:y.value.id}),h=async()=>{R.show({message:"Carregando usu\xE1rios"});try{a.value=await t()}catch(d){Q(d.message)}finally{R.hide()}},j=async(d,v)=>{try{await A(d,v),V("Status atualizado com sucesso")}catch(P){Q(P.message)}finally{h()}},W=async d=>{try{g.dialog({title:"Confirme!",message:"Tens a certeza que pretendes eliminar a conta deste Usu\xE1rio ?",cancel:!0,persistent:!0}).onOk(async()=>{await I(d),h(),V("Usu\xE1rio apagado com sucesso")})}catch(v){Q(v.message)}finally{R.hide()}},X=d=>{C.value=!0,z.value=!1,console.log(d),E.value=d.id,c.value.name=d.user_metadata.name,c.value.email=d.email,c.value.phone=d.user_metadata.phone,c.value.role=d.user_metadata.role},T=()=>{E.value="",c.value.name="",c.value.email="",c.value.phone="",c.value.role=""},Y=()=>{z.value=!0,C.value=!0,T()},x=()=>{C.value=!1,T()},ee=async()=>{try{if(D.value.loading=!0,z.value!=!0){const{email:d,name:v,phone:P,role:ae}=c.value;await N(E.value,{name:v,email:d,phone:P,role:ae}),h(),V("Usu\xE1rio actualizado com sucesso")}else await w(c.value),h(),V("Usu\xE1rio cadastrado com sucesso")}catch(d){Q(d.message)}finally{D.value.loading=!1,x()}};return le(()=>{h(),y.value.email!="ildocuema@gmail.com"&&window.history.back()}),{columns:$e,alterarRoleUser:X,apagarUser:W,users:a,btnConfig:ze,inputConfig:qe,filter:e,status:J,upateStatus:j,modal:C,itemUser:K,cancelarUpdate:x,form:c,updateFormUser:ee,progress:D,addNewUser:Y,formNewUser:z,cleanForm:T,user:y}}}),L=a=>(pe("data-v-40c9bb86"),a=a(),be(),a),Ne={class:"q-mb-md"},Ie={class:"q-ml-md"},Ee=L(()=>i("span",{class:"text-red-10"},"- Administrador",-1)),De={key:0,class:"row"},Te={key:0,style:{"border-radius":"18px","font-size":"11px"},class:"bg-cyan q-pa-sm text-white rounded"},Pe={key:1,style:{"border-radius":"18px","font-size":"11px"},class:"bg-cyan-8 q-pa-sm text-white rounded"},Re={key:2,style:{"border-radius":"18px","font-size":"11px"},class:"bg-teal-10 q-pa-sm text-white rounded"},Be={key:3,style:{"border-radius":"18px","font-size":"11px"},class:"bg-green-10 q-pa-sm text-white rounded"},Le={key:4,style:{"border-radius":"18px","font-size":"11px"},class:"bg-lime-10 q-pa-sm text-white rounded"},xe={key:5,style:{"border-radius":"18px","font-size":"11px"},class:"bg-lime-7 q-pa-sm text-white rounded"},Fe={key:6,style:{"border-radius":"18px","font-size":"11px"},class:"bg-lime-4 q-pa-sm text-white rounded"},Me={key:7,style:{"border-radius":"18px","font-size":"11px"},class:"bg-blue-grey-8 q-pa-sm text-white rounded"},Oe={key:8,style:{"border-radius":"18px","font-size":"11px"},class:"bg-blue-grey-8 q-pa-sm text-white rounded"},He={key:0,class:"text-green-10"},Ze=L(()=>i("b",null,"Activo",-1)),Ge=[Ze],Je={key:1,class:"text-red-10"},Ke=L(()=>i("b",null,"Bloqueado",-1)),je=[Ke],We={key:1,class:"flex flex-center text-body1 text-center"},Xe={class:"row text-body3 text-h5 flex-center q-pa-lg bg-secondary text-white"},Ye={class:"secondary"},ea={class:"secondary"},aa={key:3,class:"flex flex-center text-body1 text-center"},oa={key:0,class:"text-h6"},sa={key:1,class:"text-h6"};function la(a,t,A,N,I,y){const w=Z("admin-access-op");return l(),p(G,null,{default:s(()=>[o(ge,null,{default:s(()=>[o(Ue,{padding:""},{default:s(()=>[i("span",Ne,[o(q,{name:"mdi-account-group",size:"md"}),i("b",Ie,[u("UTILIZADORES "),Ee,u(" "+m(a.form.emailAdmin),1)])]),a.$q.platform.is.desktop&&a.users!=null?(l(),r("div",De,[o(_e,{rows:a.users,flat:"",bordered:"",columns:a.columns,"row-key":"id",class:"col-12","virtual-scroll":"",filter:a.filter},{top:s(()=>[o(k,_({class:"",type:"text",label:"Pesquisar"},{...a.inputConfig},{modelValue:a.filter,"onUpdate:modelValue":t[0]||(t[0]=e=>a.filter=e)}),{prepend:s(()=>[o(q,{name:"mdi-magnify"})]),_:1},16,["modelValue"]),o(ye),a.$q.platform.is.desktop?(l(),p(f,_({key:0,icon:"mdi-account-plus",label:"Criar novo utilizadores",onClick:a.addNewUser},{...a.btnConfig},{color:"primary"}),null,16,["onClick"])):n("",!0)]),"body-cell-name":s(e=>[o(S,{props:e},{default:s(()=>[u(m(e.row.user_metadata.name),1)]),_:2},1032,["props"])]),"body-cell-role":s(e=>[o(S,{props:e},{default:s(()=>[e.row.user_metadata.role=="Admin-DME"?(l(),r("span",Te,[i("b",null,m(e.row.user_metadata.role),1)])):n("",!0),e.row.user_metadata.role=="Admin-Escola"?(l(),r("span",Pe,[i("b",null,m(e.row.user_metadata.role),1)])):n("",!0),e.row.user_metadata.role=="Super-admin"?(l(),r("span",Re,[i("b",null,m(e.row.user_metadata.role),1)])):n("",!0),e.row.user_metadata.role=="User"?(l(),r("span",Be,[i("b",null,m(e.row.user_metadata.role),1)])):n("",!0),e.row.user_metadata.role=="Docente"?(l(),r("span",Le,[i("b",null,m(e.row.user_metadata.role),1)])):n("",!0),e.row.user_metadata.role=="Estudante"?(l(),r("span",xe,[i("b",null,m(e.row.user_metadata.role),1)])):n("",!0),e.row.user_metadata.role=="Encarregado"?(l(),r("span",Fe,[i("b",null,m(e.row.user_metadata.role),1)])):n("",!0),e.row.user_metadata.role=="RH-DME"?(l(),r("span",Me,[i("b",null,m(e.row.user_metadata.role),1)])):n("",!0),e.row.user_metadata.role=="Secretaria-DME"?(l(),r("span",Oe,[i("b",null,m(e.row.user_metadata.role),1)])):n("",!0)]),_:2},1032,["props"])]),"body-cell-status":s(e=>[o(S,{props:e},{default:s(()=>[e.row.user_metadata.status==!0?(l(),r("span",He,Ge)):(l(),r("span",Je,je))]),_:2},1032,["props"])]),"body-cell-actions":s(e=>[o(S,{props:e,class:"q-gutter-x-sm text-center"},{default:s(()=>[o(f,{flat:"",icon:"mdi-pencil-outline",color:"info",dense:"",size:"sm",onClick:g=>a.alterarRoleUser(e.row)},{default:s(()=>[o($,null,{default:s(()=>[u("Alterar")]),_:1})]),_:2},1032,["onClick"]),o(f,{flat:"",icon:"mdi-delete-outline",color:"negative",dense:"",size:"sm",onClick:g=>a.apagarUser(e.row.id)},{default:s(()=>[o($,null,{default:s(()=>[u("Apagar")]),_:1})]),_:2},1032,["onClick"]),a.form.emailAdmin=="ildocuema@gmail.com"?(l(),p(te,{key:0,size:"sm","checked-icon":"check",color:"green","unchecked-icon":"clear",modelValue:e.row.user_metadata.status,"onUpdate:modelValue":g=>e.row.user_metadata.status=g,onClick:g=>a.upateStatus(e.row.id,e.row.user_metadata.status)},null,8,["modelValue","onUpdate:modelValue","onClick"])):n("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])])):n("",!0),a.$q.platform.is.desktop&&a.users==null?(l(),r("div",We,[o(f,{flat:"",color:"red"},{default:s(()=>[u(" De momento n\xE3o tens nenhum usuario cadastrado ")]),_:1})])):n("",!0),a.$q.platform.is.mobile&&a.users!=null?(l(),p(he,{key:2,bordered:""},{default:s(()=>[i("div",Xe,[o(f,{flat:"",icon:"mdi-school-outline",label:"users"})]),o(U),(l(!0),r(ne,null,re(a.users,e=>M((l(),p(we,{key:e.id,class:"q-mb-sm",clickable:"",onClick:g=>a.alterarRoleUser(e)},{default:s(()=>[o(O,{avatar:""},{default:s(()=>[o(ce,{color:"primary","text-color":"white",icon:"mdi-school-outline"})]),_:1}),o(O,null,{default:s(()=>[o(B,null,{default:s(()=>[u(m(e.nome),1)]),_:2},1024),o(B,{caption:"",lines:"1"},{default:s(()=>[u("N\xBA da user: "),i("strong",Ye,m(e.numero),1)]),_:2},1024),o(B,{caption:"",lines:"1"},{default:s(()=>[u("N\xBA do decreto: "),i("strong",ea,m(e.num_decreto),1)]),_:2},1024)]),_:2},1024),o(U)]),_:2},1032,["onClick"])),[[fe]])),128))]),_:1})):n("",!0),a.$q.platform.is.mobile&&a.users==null?(l(),r("div",aa,[o(f,{color:"red"},{default:s(()=>[u(" De momento n\xE3o tens nenhum usu\xE1rio cadastrado ")]),_:1})])):n("",!0),a.$q.platform.is.mobile?(l(),p(ve,{key:4,class:"margin-bottom",position:"bottom-right",offset:[18,18]},{default:s(()=>[o(f,{fab:"",icon:"mdi-plus",color:"primary",onClick:a.addNewUser},null,8,["onClick"])]),_:1})):n("",!0),o(ie,{modelValue:a.modal,"onUpdate:modelValue":t[6]||(t[6]=e=>a.modal=e)},{default:s(()=>[o(de,null,{default:s(()=>[o(F,null,{default:s(()=>[a.formNewUser?(l(),r("div",oa,[o(q,{name:"mdi-account-cog"},{default:s(()=>[o($,null,{default:s(()=>[u("Cadastrar Utilizador")]),_:1})]),_:1}),u(" Cadastrar novo Utilizador ")])):(l(),r("div",sa,[o(q,{name:"mdi-database-plus"},{default:s(()=>[o($,null,{default:s(()=>[u("Editar Utilizador")]),_:1})]),_:1}),u(" Alterar informa\xE7\xF5es do Utilizador ")]))]),_:1}),o(U),o(ke,{onSubmit:ue(a.updateFormUser,["prevent"])},{default:s(()=>[o(F,{class:"q-gutter-md"},{default:s(()=>[o(k,_({label:"Nome",modelValue:a.form.name,"onUpdate:modelValue":t[1]||(t[1]=e=>a.form.name=e)},{...a.inputConfig},{"lazy-roles":"",roles:[e=>!!e||"Informe o nome"]}),null,16,["modelValue","roles"]),o(k,_({label:"E-mail",modelValue:a.form.email,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.email=e)},{...a.inputConfig},{"lazy-roles":"",roles:[e=>!!e||"Informe o e-mail do usu\xE1rio"]}),null,16,["modelValue","roles"]),o(k,_({label:"Telemovel",modelValue:a.form.phone,"onUpdate:modelValue":t[3]||(t[3]=e=>a.form.phone=e)},{...a.inputConfig},{"lazy-roles":"",roles:[e=>!!e||"Informe o n\xBA de Telem\xF3vel do usu\xE1rio"]}),null,16,["modelValue","roles"]),a.formNewUser?(l(),p(k,_({key:0,type:"password",label:"Digite uma senha",modelValue:a.form.password,"onUpdate:modelValue":t[4]||(t[4]=e=>a.form.password=e)},{...a.inputConfig},{"lazy-roles":"",roles:[e=>!!e||"Digite uma senha v\xE1lida"]}),null,16,["modelValue","roles"])):n("",!0),o(w,{emailAccess:a.form.emailAdmin,modelValue:a.form.role,"onUpdate:modelValue":t[5]||(t[5]=e=>a.form.role=e)},null,8,["emailAccess","modelValue"])]),_:1}),o(U),o(me,{align:"right"},{default:s(()=>[M(o(f,{flat:"",label:"Cancelar",color:"primary",onClick:a.cancelarUpdate,icon:"mdi-close"},null,8,["onClick"]),[[Ce]]),a.formNewUser?(l(),p(f,{key:0,loading:a.progress.loading,flat:"",label:"Cadastrar",color:"primary",type:"submit",icon:"mdi-database-plus"},null,8,["loading"])):(l(),p(f,{key:1,loading:a.progress.loading,flat:"",label:"Actualizar",color:"primary",type:"submit",icon:"mdi-check"},null,8,["loading"]))]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}var ta=H(Ae,[["render",la],["__scopeId","data-v-40c9bb86"]]);const ra={name:"Acesso-Permissao",components:{listUser:ta},setup(){return{}}};function na(a,t,A,N,I,y){const w=Z("list-user");return l(),p(G,null,{default:s(()=>[o(U),o(w)]),_:1})}var Aa=H(ra,[["render",na]]);export{Aa as default};

import{_ as Z,r as a,C as K,D as X,z as $,f as oo,E as x,p as eo,G as ao,t as n,s as u,H as m,Q as V,x as k,y as so,aZ as lo,I as to}from"./index.e70dc7e8.js";import{Q as no}from"./QSelect.9e4cb652.js";import{Q as ro}from"./QSpace.cccfce51.js";import{Q as io}from"./QTd.e931d9bd.js";import{Q as co}from"./QTable.324e303e.js";import{A as uo,s as mo,u as po,c as vo,E as fo}from"./table.472ab7a0.js";import{u as wo}from"./cursos.717f0f89.js";import"./escolas.10bad4c2.js";import{u as _o}from"./turmas.a4794dff.js";import{u as ho}from"./classes.b7b7d12e.js";import{u as go}from"./periodos.7ed32d98.js";import"./position-engine.1f1eaf41.js";import"./selection.ded15137.js";import"./QItemLabel.f0026656.js";import"./QMenu.704bcb1b.js";import"./rtl.b51694b1.js";import"./QList.9cd80ca5.js";import"./use-fullscreen.63635d9e.js";import"./useNotify.e83fbf31.js";import"./QForm.7b26f9a5.js";import"./ClosePopup.39a76e78.js";import"./moment.40bc58bf.js";const Ao={components:{AlunosForm:uo,showInformation:mo},setup(){const p=a(!1),t=a(!1),v=a(!1),{user:e}=K(),I=a(!1);new Date().getFullYear();const f=a([]),w=a([]),l=a([]),g=a([]),O=a(""),{addAluno:Q,AlunosCountByEscolaId:N,deleteAlunoById:So,getAllAlunos:L,getAlunoById:Eo,updateAlunoById:R,getEscolaIdByEmail:U,getAnoLectivoIdByEscolaId:M,addOrUpdateAnoLectivo:F}=po(),_=a(""),{getAllPeriodos:T}=go(),{getAllTurmas:D}=_o(),{getAllClasses:q}=ho(),{getAllCursos:P}=wo(),h=a(0),C=a(!1),z=a(""),r=a(""),Y=a({}),S=a([]),j=a({}),i=a([]),J=X();$(async()=>{const o=await U(e.value.email);h.value=o[0].id,A(o[0].id),O.value=o[0].nivel_ensino,F(o[0].id),i.value=await L(o[0].id),w.value=await D(o[0].id),await E(o[0].id),q(o[0].id).then(s=>{l.value=s}),S.value=await P(o[0].id),g.value=await T(o[0].id)});const A=async o=>{try{i.value=await L(o)}catch(s){console.log(s)}},W=o=>{v.value=!1,C.value=!0},G=async o=>{try{p.value=!0,v.value?(await R(o.id,o),A(h.value)):(console.log(o),await Q(o),A(h.value))}catch(s){console.log(s)}finally{p.value=!1}},E=o=>{M(o).then(s=>{f.value=s})},d=oo(()=>(console.log(_.value),!r.value&&!_.value?i.value:i.value.filter(o=>(o.nome.toLowerCase().includes(r.value.toLowerCase())||o.turmas.nome_turma.toLowerCase().includes(r.value.toLowerCase())||o.turmas.num_sala.toLowerCase().includes(r.value.toLowerCase())||o.periodo.nome_periodo.toLowerCase().includes(r.value.toLowerCase())||o.ano_lectivo.toLowerCase().includes(r.value.toLowerCase()))&&o.ano_lectivo.includes(_.value))));return{rows:i,columns:vo,search:z,filter:r,loading:p,formModal:W,aluno:Y,showModal:C,handleSave:G,formStatus:v,AlunosCountByEscolaId:N,escolaId:h,showModal2:I,AlunoInfo:j,cursos:S,getAllAnoLectivo:E,yearOptions:f,nivel_de_ensino:O,turmasOptions:w,classesOptions:l,periodoOptions:g,printList:async()=>{t.value=!0;const o=new fo.Workbook,s=o.addWorksheet("Alunos");s.addRow(["Turma","Classe","Ano lectivo"]),s.addRow([d.value[0].turmas.nome_turma,d.value[0].classes.nome_classe,d.value[0].ano_lectivo]),s.addRow(["Cod.","Nome completo","Idade"]),d.value.forEach(c=>{s.addRow([c.id,c.nome,new Date().getFullYear()-new Date(c.data_nascimento).getFullYear()])}),await o.xlsx.writeBuffer().then(c=>{const H=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),b=URL.createObjectURL(H),y=document.createElement("a");y.href=b,y.download="alunos.xlsx",y.click(),URL.revokeObjectURL(b),t.value=!1})},filteredRows:d,anoLectivoSelect:_,loadingDownload:t,addOrEditNotas:o=>{console.log(o);const s=JSON.stringify(o);J.push({name:"addOrEditNota",params:{info:s}})}}}},yo=m("br",null,null,-1),Io=m("br",null,null,-1),Oo={class:""},Lo={class:"text-red-10"};function Co(p,t,v,e,I,B){const f=x("AlunosForm"),w=x("showInformation");return eo(),ao("div",null,[yo,Io,n(co,{flat:"",dense:"",bordered:"",rows:e.rows,columns:e.columns,"row-key":"id",filter:e.filter,loading:e.loading,class:"q-mt-lg"},{"top-left":u(()=>[m("span",null,[m("div",Oo,[n(V,{name:"mdi-school",size:"md"}),k(" Alunos [ "),m("b",Lo,so(e.AlunosCountByEscolaId(e.escolaId)),1),k(" ] ")])])]),"top-right":u(()=>[n(no,{color:"primary",modelValue:e.anoLectivoSelect,"onUpdate:modelValue":t[0]||(t[0]=l=>e.anoLectivoSelect=l),label:"Ano lectivo",options:e.yearOptions,dense:"",outlined:"",class:"q-mr-sm","option-value":"ano_lectivo","option-label":"ano_lectivo","map-options":"","emit-value":"",style:{"min-width":"180px"}},null,8,["modelValue","options"]),n(lo,{color:"primary",modelValue:e.filter,"onUpdate:modelValue":t[1]||(t[1]=l=>e.filter=l),lable:"Pesquisar",placeholder:"Pesquisar",dense:"",outlined:"",class:"q-mr-sm"},{append:u(()=>[n(V,{name:"search"})]),_:1},8,["modelValue"]),n(ro)]),"body-cell-options":u(l=>[n(io,{props:l},{default:u(()=>[n(to,{flat:"",dense:"",icon:"mdi-microsoft-excel",color:"green-9",onClick:g=>e.addOrEditNotas(l.row),size:"sm",title:"Mini-pautas-edit"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter","loading"]),n(f,{modelValue:e.showModal,"onUpdate:modelValue":t[2]||(t[2]=l=>e.showModal=l),showInfoToEdit:e.aluno,onSave:e.handleSave,loading:e.loading,isEditForm:e.formStatus,cursos:e.cursos,nome:"aluno",anoLectivoOptions:e.yearOptions,nivel_ensino:e.nivel_de_ensino,turmasOptions:e.turmasOptions,classesOptions:e.classesOptions,periodoOptions:e.periodoOptions,escolaId:e.escolaId},null,8,["modelValue","showInfoToEdit","onSave","loading","isEditForm","cursos","anoLectivoOptions","nivel_ensino","turmasOptions","classesOptions","periodoOptions","escolaId"]),n(w,{modelValue:e.showModal2,"onUpdate:modelValue":t[3]||(t[3]=l=>e.showModal2=l),showInformation:e.AlunoInfo,nome:"aluno"},null,8,["modelValue","showInformation"])])}var Xo=Z(Ao,[["render",Co]]);export{Xo as default};

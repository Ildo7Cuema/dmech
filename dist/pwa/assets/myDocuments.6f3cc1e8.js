import{P as S,aW as k,aP as v,_ as B,r as p,aX as M,o as N,k as T,H as q,I as A,J as r,K as o,W as l,Q as _,M as y,N as w,Y as h,aY as O,aT as U,aS as D,b7 as V,X as b}from"./index.35821edc.js";import{Q as z}from"./QSpace.d25d6d7b.js";import{Q as P}from"./QTable.516d2110.js";import{Q as E}from"./QPage.a66fc822.js";import{a as I,b as R}from"./QLayout.d35a44ea.js";import{u as L}from"./useNotify.4729e429.js";import{u as W}from"./use-quasar.0c1c42d6.js";import"./QList.7454f32f.js";import"./QSelect.e06743c9.js";import"./QMenu.c301a8bc.js";import"./selection.364e49a0.js";import"./QItemLabel.ce2d3637.js";import"./rtl.b51694b1.js";import"./use-fullscreen.61378003.js";const{supabase:m,supabaseAdmin:ye}=v();S();const u=k("myDocument",{state:()=>({myDocument:[]}),getters:{myDocumentCount:n=>n.myDocument.length},actions:{async getMyDocument(n){const{data:t,error:a}=await m.from("docFuncionario").select("*").eq("id_funcionario",5);if(a)throw a;return this.$state.myDocument=t},async downloadFile(n){const{data:t,error:a}=await m.storage.from("docFuncionarios").download(n);if(a)console.log(a);else{const e=new Blob([t],{type:"application/octet-stream"}),i=URL.createObjectURL(e),c=document.createElement("a");c.href=i,c.download=n+".pdf",c.click()}},async deleteFile(n,t){const{data:a,error:e}=await m.from("docFuncionario").delete().match({id:n});if(e)throw e;return this.deleteFileBucket(t),a},async deleteFileBucket(n){const{data:t,error:a}=await m.storage.from("docFuncionarios").remove([n]);if(a)throw a;return t}}}),X=[{name:"nome_doc",label:"Nome do Doc:",align:"left",field:"nome_doc",sortable:!0},{name:"file_name",label:"ID-DOC",align:"left",field:"file_name",sortable:!0}],Y={name:"page-Document-Docente",setup(n){const t=p(""),a=p([]),e=W(),i=u(),{myDocumentCount:c,myDocument:s}=M(i),{notifyError:f,notifySuccess:F}=L(),Q=p(!1);N(()=>{C()});const x=T(()=>s.value),C=()=>{u().getMyDocument(),a.value=s.value};return{downloadFile:async d=>{try{e.loading.show({message:"Aguarda enquanto descarrega o documento"}),await u().downloadFile(d),F("Documento descarregado do sucesso")}catch{f("N\xE3o foi poss\xEDvel descarregar o documento")}finally{e.loading.hide()}},computedDocs:x,myDocumentCount:c,myDocument:s,filter:t,columns:X,apagarFile:async(d,g)=>{e.dialog({title:"Confirme",message:"Tens a certeza que pretendes apagar este documento?",cancel:!0,persistent:!0}).onOk(async()=>{e.loading.show({message:"Aguarda enquanto apaga"}),await u().deleteFile(d,g),e.loading.hide()}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})},loading:Q}}},j={class:"row h5 text-primary"},H={class:"text-bold"},J={class:"text-bold"},K={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},G=l("br",null,null,-1),Z=l("br",null,null,-1);function $(n,t,a,e,i,c){return q(),A(I,null,{default:r(()=>[o(R,null,{default:r(()=>[o(E,{padding:""},{default:r(()=>[l("div",j,[l("div",H,[o(_,{name:"mdi-folder-account",size:"lg"}),y(" MEUS DOCUMENTOS ")]),o(z),l("div",J,"Total: "+w(e.myDocumentCount),1)]),o(h),o(P,{grid:"",flat:"",bordered:"",title:"Reposit\xF3rio de documentos pessoais",rows:e.computedDocs,columns:e.columns,"row-key":"name",filter:e.filter,"hide-header":""},{"top-right":r(()=>[o(O,{borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":t[0]||(t[0]=s=>e.filter=s),placeholder:"Procurar"},{append:r(()=>[o(_,{name:"search"})]),_:1},8,["modelValue"])]),item:r(s=>[l("div",K,[o(U,{flat:"",bordered:""},{default:r(()=>[o(D,{class:"text-center"},{default:r(()=>[y(" Documento "),G,o(_,{name:"mdi-file-pdf",size:"lg",color:"red-10"}),Z,l("strong",null,w(s.row.nome_doc),1)]),_:2},1024),o(h),o(D,{class:"flex flex-center",style:V({fontSize:s.row.calories/2+"px"})},{default:r(()=>[o(b,{loading:e.loading,label:"Apagar",dense:"",icon:"mdi-delete-circle-outline","no-caps":"",flat:"",color:"red-10",onClick:f=>e.apagarFile(s.row.id,s.row.file_name)},null,8,["loading","onClick"]),o(b,{loading:e.loading,label:"Baixar",dense:"",icon:"mdi-cloud-download-outline","no-caps":"",flat:"",color:"green-10",onClick:f=>e.downloadFile(s.row.file_name)},null,8,["loading","onClick"])]),_:2},1032,["style"])]),_:2},1024)])]),_:1},8,["rows","columns","filter"])]),_:1})]),_:1})]),_:1})}var we=B(Y,[["render",$]]);export{we as default};

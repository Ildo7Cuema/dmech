import{_ as eo,r as l,C as lo,D as ao,z as no,f as so,E as B,p as to,G as io,t as s,s as w,H as _,Q,x as R,y as ro,aZ as co,I as g}from"./index.bc90a1a6.js";import{Q as uo}from"./QSelect.1664c3a2.js";import{Q as mo}from"./QSpace.e93ae0b1.js";import{Q as vo}from"./QTd.6b6bfcad.js";import{Q as fo}from"./QTable.da9f4085.js";import{A as po,s as wo,u as go,c as _o,E as ho}from"./table.2531e228.js";import{u as yo}from"./cursos.5ad1e744.js";import"./escolas.b2d9c76e.js";import{u as Co}from"./turmas.ff1f2fa7.js";import{u as Ao}from"./classes.961656d5.js";import{u as Io}from"./periodos.f16bf4a3.js";import"./position-engine.8c426333.js";import"./selection.bbfae355.js";import"./QItemLabel.d3c30afe.js";import"./QMenu.456c4d11.js";import"./rtl.b51694b1.js";import"./QList.ac9043eb.js";import"./use-fullscreen.28de194d.js";import"./useNotify.98763d5b.js";import"./QForm.d8ddec26.js";import"./ClosePopup.36ee2ee1.js";import"./moment.40bc58bf.js";const Lo={components:{AlunosForm:po,showInformation:wo},setup(){const r=l(!1),t=l(!1),c=l(!1),{user:o}=lo(),A=l(!1);new Date().getFullYear();const h=l([]),y=l([]),n=l([]),u=l([]),O=l(""),{addAluno:M,AlunosCountByEscolaId:N,deleteAlunoById:D,getAllAlunos:b,getAlunoById:xo,updateAlunoById:F,getEscolaIdByEmail:T,getAnoLectivoIdByEscolaId:q,addOrUpdateAnoLectivo:z}=go(),C=l(""),{getAllPeriodos:P}=Io(),{getAllTurmas:Y}=Co(),{getAllClasses:j}=Ao(),{getAllCursos:J}=yo(),d=l(0),I=l(!1),W=l(""),i=l(""),k=l({}),S=l([]),E=l({}),m=l([]),G=ao();no(async()=>{const e=await T(o.value.email);d.value=e[0].id,v(e[0].id),O.value=e[0].nivel_ensino,z(e[0].id),m.value=await b(e[0].id),y.value=await Y(e[0].id),await x(e[0].id),j(e[0].id).then(a=>{n.value=a}),S.value=await J(e[0].id),u.value=await P(e[0].id)});const v=async e=>{try{m.value=await b(e)}catch(a){console.log(a)}},H=e=>{E.value={...e},A.value=!0},Z=e=>{k.value={...e},c.value=!0,I.value=!0},K=async e=>{r.value=!0;try{await D(e),v(d.value)}catch(a){console.log(a)}finally{v(d.value),r.value=!1}},X=e=>{c.value=!1,I.value=!0},$=async e=>{try{r.value=!0,c.value?(await F(e.id,e),v(d.value)):(console.log(e),await M(e),v(d.value))}catch(a){console.log(a)}finally{r.value=!1}},x=e=>{q(e).then(a=>{h.value=a})},f=so(()=>(console.log(C.value),!i.value&&!C.value?m.value:m.value.filter(e=>(e.nome.toLowerCase().includes(i.value.toLowerCase())||e.turmas.nome_turma.toLowerCase().includes(i.value.toLowerCase())||e.turmas.num_sala.toLowerCase().includes(i.value.toLowerCase())||e.periodo.nome_periodo.toLowerCase().includes(i.value.toLowerCase())||e.ano_lectivo.toLowerCase().includes(i.value.toLowerCase()))&&e.ano_lectivo.includes(C.value))));return{rows:m,columns:_o,search:W,filter:i,loading:r,edit:Z,remove:K,formModal:X,aluno:k,showModal:I,handleSave:$,formStatus:c,AlunosCountByEscolaId:N,escolaId:d,information:H,showModal2:A,AlunoInfo:E,cursos:S,getAllAnoLectivo:x,yearOptions:h,nivel_de_ensino:O,turmasOptions:y,classesOptions:n,periodoOptions:u,printList:async()=>{t.value=!0;const e=new ho.Workbook,a=e.addWorksheet("Alunos");a.addRow(["Turma","Classe","Ano lectivo"]),a.addRow([f.value[0].turmas.nome_turma,f.value[0].classes.nome_classe,f.value[0].ano_lectivo]),a.addRow(["Cod.","Nome completo","Idade"]),f.value.forEach(p=>{a.addRow([p.id,p.nome,new Date().getFullYear()-new Date(p.data_nascimento).getFullYear()])}),await e.xlsx.writeBuffer().then(p=>{const oo=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),V=URL.createObjectURL(oo),L=document.createElement("a");L.href=V,L.download="alunos.xlsx",L.click(),URL.revokeObjectURL(V),t.value=!1})},filteredRows:f,anoLectivoSelect:C,loadingDownload:t,addOrEditNotas:e=>{console.log(e);const a=JSON.stringify(e);G.push({name:"addOrEditNota",params:{info:a}})}}}},Oo=_("br",null,null,-1),bo=_("br",null,null,-1),ko={class:""},So={class:"text-red-10"};function Eo(r,t,c,o,A,U){const h=B("AlunosForm"),y=B("showInformation");return to(),io("div",null,[Oo,bo,s(fo,{flat:"",dense:"",bordered:"",rows:o.rows,columns:o.columns,"row-key":"id",filter:o.filter,loading:o.loading,class:"q-mt-lg"},{"top-left":w(()=>[_("span",null,[_("div",ko,[s(Q,{name:"mdi-school",size:"md"}),R(" Alunos [ "),_("b",So,ro(o.AlunosCountByEscolaId(o.escolaId)),1),R(" ] ")])])]),"top-right":w(()=>[s(uo,{color:"primary",modelValue:o.anoLectivoSelect,"onUpdate:modelValue":t[0]||(t[0]=n=>o.anoLectivoSelect=n),label:"Ano lectivo",options:o.yearOptions,dense:"",outlined:"",class:"q-mr-sm","option-value":"ano_lectivo","option-label":"ano_lectivo","map-options":"","emit-value":"",style:{"min-width":"180px"}},null,8,["modelValue","options"]),s(co,{color:"primary",modelValue:o.filter,"onUpdate:modelValue":t[1]||(t[1]=n=>o.filter=n),lable:"Pesquisar",placeholder:"Pesquisar",dense:"",outlined:"",class:"q-mr-sm"},{append:w(()=>[s(Q,{name:"search"})]),_:1},8,["modelValue"]),s(mo),s(g,{outline:"",color:"primary",disable:o.loading,label:"Novo aluno",onClick:o.formModal,"no-caps":"",icon:"mdi-database-plus",filter:o.filter},null,8,["disable","onClick","filter"]),s(g,{outline:"",color:"grey-7",disable:o.loadingDownload,label:"Baixar lista",onClick:o.printList,"no-caps":"",icon:"cloud_download",filter:o.filter,class:"q-ml-sm",loading:o.loadingDownload},null,8,["disable","onClick","filter","loading"])]),"body-cell-options":w(n=>[s(vo,{props:n},{default:w(()=>[s(g,{flat:"",dense:"",icon:"mdi-file-edit-outline",color:"green-9",onClick:u=>o.edit(n.row),size:"sm"},null,8,["onClick"]),s(g,{flat:"",dense:"",icon:"mdi-delete-outline",color:"red-9",onClick:u=>o.remove(n.row.id),loading:o.loading,size:"sm"},null,8,["onClick","loading"]),s(g,{flat:"",dense:"",icon:"mdi-information-outline",color:"grey-9",onClick:u=>o.information(n.row),size:"sm"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter","loading"]),s(h,{modelValue:o.showModal,"onUpdate:modelValue":t[2]||(t[2]=n=>o.showModal=n),showInfoToEdit:o.aluno,onSave:o.handleSave,loading:o.loading,isEditForm:o.formStatus,cursos:o.cursos,nome:"aluno",anoLectivoOptions:o.yearOptions,nivel_ensino:o.nivel_de_ensino,turmasOptions:o.turmasOptions,classesOptions:o.classesOptions,periodoOptions:o.periodoOptions,escolaId:o.escolaId},null,8,["modelValue","showInfoToEdit","onSave","loading","isEditForm","cursos","anoLectivoOptions","nivel_ensino","turmasOptions","classesOptions","periodoOptions","escolaId"]),s(y,{modelValue:o.showModal2,"onUpdate:modelValue":t[3]||(t[3]=n=>o.showModal2=n),showInformation:o.AlunoInfo,nome:"aluno"},null,8,["modelValue","showInformation"])])}var ee=eo(Lo,[["render",Eo]]);export{ee as default};

import{C as S,aW as k,aC as v,_ as B,r as p,aX as q,z as T,f as z,p as A,q as M,s as r,t as o,H as l,Q as _,x as y,y as w,K as h,aZ as N,aT as O,aS as D,b8 as U,I as b}from"./index.e70dc7e8.js";import{Q as V}from"./QSpace.cccfce51.js";import{Q as E}from"./QTable.324e303e.js";import{Q as I}from"./QPage.63b09b87.js";import{a as R,b as L}from"./QLayout.ca9f809c.js";import{u as P}from"./useNotify.e83fbf31.js";import{u as j}from"./use-quasar.4cac9bb9.js";import"./QList.9cd80ca5.js";import"./QSelect.9e4cb652.js";import"./position-engine.1f1eaf41.js";import"./selection.ded15137.js";import"./QItemLabel.f0026656.js";import"./QMenu.704bcb1b.js";import"./rtl.b51694b1.js";import"./use-fullscreen.63635d9e.js";const{supabase:m,supabaseAdmin:we}=v();S();const u=k("myDocument",{state:()=>({myDocument:[]}),getters:{myDocumentCount:n=>n.myDocument.length},actions:{async getMyDocument(n){const{data:t,error:a}=await m.from("docFuncionario").select("*").eq("id_funcionario",5);if(a)throw a;return this.$state.myDocument=t},async downloadFile(n){const{data:t,error:a}=await m.storage.from("docFuncionarios").download(n);if(a)console.log(a);else{const e=new Blob([t],{type:"application/octet-stream"}),i=URL.createObjectURL(e),c=document.createElement("a");c.href=i,c.download=n+".pdf",c.click()}},async deleteFile(n,t){const{data:a,error:e}=await m.from("docFuncionario").delete().match({id:n});if(e)throw e;return this.deleteFileBucket(t),a},async deleteFileBucket(n){const{data:t,error:a}=await m.storage.from("docFuncionarios").remove([n]);if(a)throw a;return t}}}),H=[{name:"nome_doc",label:"Nome do Doc:",align:"left",field:"nome_doc",sortable:!0},{name:"file_name",label:"ID-DOC",align:"left",field:"file_name",sortable:!0}],K={name:"page-Document-Docente",setup(n){const t=p(""),a=p([]),e=j(),i=u(),{myDocumentCount:c,myDocument:s}=q(i),{notifyError:f,notifySuccess:C}=P(),x=p(!1);T(()=>{Q()});const F=z(()=>s.value),Q=()=>{u().getMyDocument(),a.value=s.value};return{downloadFile:async d=>{try{e.loading.show({message:"Aguarda enquanto descarrega o documento"}),await u().downloadFile(d),C("Documento descarregado do sucesso")}catch{f("N\xE3o foi poss\xEDvel descarregar o documento")}finally{e.loading.hide()}},computedDocs:F,myDocumentCount:c,myDocument:s,filter:t,columns:H,apagarFile:async(d,g)=>{e.dialog({title:"Confirme",message:"Tens a certeza que pretendes apagar este documento?",cancel:!0,persistent:!0}).onOk(async()=>{e.loading.show({message:"Aguarda enquanto apaga"}),await u().deleteFile(d,g),e.loading.hide()}).onOk(()=>{}).onCancel(()=>{}).onDismiss(()=>{})},loading:x}}},W={class:"row h5 text-primary"},X={class:"text-bold"},Z={class:"text-bold"},G={class:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},J=l("br",null,null,-1),Y=l("br",null,null,-1);function $(n,t,a,e,i,c){return A(),M(R,null,{default:r(()=>[o(L,null,{default:r(()=>[o(I,{padding:""},{default:r(()=>[l("div",W,[l("div",X,[o(_,{name:"mdi-folder-account",size:"lg"}),y(" MEUS DOCUMENTOS ")]),o(V),l("div",Z,"Total: "+w(e.myDocumentCount),1)]),o(h),o(E,{grid:"",flat:"",bordered:"",title:"Reposit\xF3rio de documentos pessoais",rows:e.computedDocs,columns:e.columns,"row-key":"name",filter:e.filter,"hide-header":""},{"top-right":r(()=>[o(N,{borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":t[0]||(t[0]=s=>e.filter=s),placeholder:"Procurar"},{append:r(()=>[o(_,{name:"search"})]),_:1},8,["modelValue"])]),item:r(s=>[l("div",G,[o(O,{flat:"",bordered:""},{default:r(()=>[o(D,{class:"text-center"},{default:r(()=>[y(" Documento "),J,o(_,{name:"mdi-file-pdf",size:"lg",color:"red-10"}),Y,l("strong",null,w(s.row.nome_doc),1)]),_:2},1024),o(h),o(D,{class:"flex flex-center",style:U({fontSize:s.row.calories/2+"px"})},{default:r(()=>[o(b,{loading:e.loading,label:"Apagar",dense:"",icon:"mdi-delete-circle-outline","no-caps":"",flat:"",color:"red-10",onClick:f=>e.apagarFile(s.row.id,s.row.file_name)},null,8,["loading","onClick"]),o(b,{loading:e.loading,label:"Baixar",dense:"",icon:"mdi-cloud-download-outline","no-caps":"",flat:"",color:"green-10",onClick:f=>e.downloadFile(s.row.file_name)},null,8,["loading","onClick"])]),_:2},1032,["style"])]),_:2},1024)])]),_:1},8,["rows","columns","filter"])]),_:1})]),_:1})]),_:1})}var he=B(K,[["render",$]]);export{he as default};
